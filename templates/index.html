<!DOCTYPE html>
<html>
<head>
    <title>LED Control</title>
</head>
<body>
    <h1>LED Control</h1>
    <button id="onBtn">LED ON</button>
    <button id="offBtn">LED OFF</button>
    <p id="status">LED State: UNKNOWN</p>

    <script>
        // Build WS URL dynamically to match Render's deployment (https → wss, http → ws)
        const wsProtocol = window.location.protocol === "https:" ? "wss://" : "ws://";
        const wsUrl = wsProtocol + window.location.host + "/ws";
        const ws = new WebSocket(wsUrl);

        ws.onopen = () => {
            console.log("Connected to server");
            ws.send(JSON.stringify({ type: "get_state" }));
        };

        ws.onmessage = (event) => {
            console.log("Message from server:", event.data);
            try {
                const data = JSON.parse(event.data);
                if (data.type === "state") {
                    document.getElementById("status").textContent = "LED State: " + data.state;
                }
            } catch (e) {
                console.error("Invalid JSON:", e);
            }
        };

        document.getElementById("onBtn").onclick = () => {
            ws.send(JSON.stringify({ type: "toggle", state: "ON" }));
        };

        document.getElementById("offBtn").onclick = () => {
            ws.send(JSON.stringify({ type: "toggle", state: "OFF" }));
        };
    </script>
</body>
</html>
